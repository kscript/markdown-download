import path from"path-browserify";export const isBrowser="undefined"!=typeof window&&window instanceof Object;export const isExtension=isBrowser&&window.chrome instanceof Object&&window.chrome.runtime;export const getExt=e=>path.parse(e).ext.slice(1);export const query=(e,t=document)=>e instanceof NodeList||e instanceof Node?e:t.querySelector(e);export const getText=(e,t=document)=>(query(e,t)||{}).innerText||"";export const getAttribute=(e,t,o=document)=>{const n=query(t,o);return n&&n.getAttribute(e)||""};export const queryAll=(e,t=document)=>[].slice.apply(t.querySelectorAll(e));export const noop=(e,t)=>"function"==typeof e?e:"function"==typeof t?t:()=>{};export const encodeUrlData=e=>{let t="";for(let o in e)t+=o+"="+encodeURIComponent(e[o])+"&";return t.slice(0,-1)};export const encodeOptionsData=e=>(!1!==e.stringify&&"object"==typeof e.data&&(e.data=encodeUrlData(e.data)),e);export const sendMessage=(e,t,o,n)=>{isExtension&&(n=isNaN(n)?3:+n,encodeOptionsData(e),chrome.runtime.sendMessage(e,(([r,s,c,a])=>{if(!r)try{const e=noop(t)(s,c,a);if(void 0===e)return s;r=e}catch(e){r=e}n-- >0?sendMessage(e,t,o,n):noop(o)(r,c,a)})))};export const formatDate=(e,t)=>{(t="string"!=typeof t&&isNaN(t)?t:new Date(t))instanceof Date==0&&(t=new Date);const o={yyyyyyyy:t.getFullYear(),yy:t.getFullYear(),MM:t.getMonth()+1,dd:t.getDate(),HH:t.getHours(),hh:t.getHours()%12,mm:t.getMinutes(),ss:t.getSeconds(),ww:"日一二三四五六".split("")[t.getDay()]};return e.replace(/([a-z]+)/gi,(function(e){return(0===o[e+e]?"0":o[e+e])||("0"+o[e]).slice(-2)}))};export const insertAfter=(e,t)=>{const o=t.parentNode;o.lastChild===t?o.appendChild(e):o.insertBefore(e,t.nextSibling)};export const getUrl=(e,t)=>t?/^(http|https)/.test(t)?t:/^\/\//.test(t)?e.split("//")[0]+t:e+t:"";export const exec=async(...e)=>{if(!e.length)return exec.returnValue;exec.returnValue=!1;try{exec.returnValue="function"==typeof e[0]&&await e[0](...e.slice(1))}catch(e){console.warn(e)}};export const getLocalOptions=()=>new Promise((e=>{chrome.storage.local.get("localOptions",(({localOptions:t})=>{e(t instanceof Object?t:{})}))}));export default{isBrowser,isExtension,getExt,query,getText,getAttribute,queryAll,noop,encodeUrlData,encodeOptionsData,sendMessage,formatDate,insertAfter,getUrl,exec,getLocalOptions};