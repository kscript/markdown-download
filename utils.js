import path from"path-browserify";export const isBrowser="undefined"!=typeof window&&window instanceof Object;export const isExtension=isBrowser&&window.chrome instanceof Object&&window.chrome.runtime;export const formatName=e=>("string"==typeof e?e:"").replace(/\s/g,"%20").split("?").shift();export const getExt=e=>formatName(path.parse(e).ext.slice(1));export const query=(e,t=document)=>e instanceof NodeList||e instanceof Node?e:t.querySelector(e);export const getText=(e,t=document)=>(query(e,t)||{}).innerText||"";export const getAttribute=(e,t,o=document)=>{const s=query(t,o);return s&&s.getAttribute(e)||""};export const queryAll=(e,t=document)=>[].slice.apply(t.querySelectorAll(e));export const noop=(e,t)=>"function"==typeof e?e:"function"==typeof t?t:()=>{};export const encodeUrlData=e=>{let t="";for(let o in e)t+=o+"="+encodeURIComponent(e[o])+"&";return t.slice(0,-1)};export const encodeOptionsData=e=>(!1!==e.stringify&&"object"==typeof e.data&&(e.data=encodeUrlData(e.data)),e);export const sendMessage=(e,t,o,s)=>{isExtension&&(s=isNaN(s)?3:+s,encodeOptionsData(e),chrome.runtime.sendMessage(e,(([n,r,a,c])=>{if(!n)try{const e=noop(t)(r,a,c);if(void 0===e)return r;n=e}catch(e){n=e}s-- >0?sendMessage(e,t,o,s):noop(o)(n,a,c)})))};export const formatDate=(e,t)=>{(t="string"!=typeof t&&isNaN(t)?t:new Date(t))instanceof Date==0&&(t=new Date);const o={yyyyyyyy:t.getFullYear(),yy:t.getFullYear(),MM:t.getMonth()+1,dd:t.getDate(),HH:t.getHours(),hh:t.getHours()%12,mm:t.getMinutes(),ss:t.getSeconds(),ww:"日一二三四五六".split("")[t.getDay()]};return e.replace(/([a-z]+)/gi,(function(e){return(0===o[e+e]?"0":o[e+e])||("0"+o[e]).slice(-2)}))};export const insertAfter=(e,t)=>{const o=t.parentNode;o.lastChild===t?o.appendChild(e):o.insertBefore(e,t.nextSibling)};export const getUrl=(e,t)=>t?/^(http|https)/.test(t)?t:/^\/\//.test(t)?e.split("//")[0]+t:e+t:"";export const exec=async(...e)=>{if(!e.length)return exec.returnValue;exec.returnValue=!1;try{exec.returnValue="function"==typeof e[0]&&await e[0](...e.slice(1))}catch(e){console.warn(e)}return exec.returnValue};export const getLocal=e=>new Promise((t=>{chrome.storage.local.get(e,(o=>{t(o[e])}))}));export const setWebsite=async(e,t)=>{const o=await getLocal("websites"),s=Object.assign({},o instanceof Object?o:{}),n=[[e&&"string"==typeof e,"第一个参数应该是字符串类型, 并且不能为空"],[Array.isArray(t.hosts)&&t.hosts.length,"options.hosts应该是数组，并且长度不能为0"],[(t.selectors||{}).body,"options.selectors.body不能为空"]].find((e=>!e[0]));return n?null===t?(delete s[e],chrome.storage.local.set({websites:s})):n[1]&&console.warn(n[1]):(t.origin=e,t.timestamp=Date.now(),t.hosts=t.hosts.map((e=>e.toString())),Object.assign(s,{[e]:t}),chrome.storage.local.set({websites:s})),s};export default{isBrowser,isExtension,formatName,getExt,query,getText,getAttribute,queryAll,noop,encodeUrlData,encodeOptionsData,sendMessage,formatDate,insertAfter,getUrl,exec,getLocal,setWebsite};